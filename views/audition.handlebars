{{! views/audition.handlebars }}
{{!-- audition.handlebars: Project-specific or generic audition submission form --}}
{{> header}}
<div class="container mt-5">
  <h1 class="display-4 mb-4">
    {{!-- Show project name if present, otherwise generic heading --}}
    {{#if project}}
      Submit Audition for <span class="text-primary">{{project.name}}</span>
    {{else}}
      Submit Your Audition
    {{/if}}
  </h1>
  {{!-- Form action is dynamic: /audition/:projectId for project-specific, /audition for generic --}}
  <form action="{{#if project}}/audition/{{project.id}}{{else}}/audition{{/if}}" method="POST" enctype="multipart/form-data" class="needs-validation" novalidate>
    <div class="row">
      <div class="col-md-6 mb-3">
        <label for="first_name_he" class="form-label">שם פרטי (First Name, Hebrew)</label>
        <input type="text" class="form-control" id="first_name_he" name="first_name_he" dir="rtl" required>
        <div class="invalid-feedback">נא להזין שם פרטי בעברית.</div>
      </div>
      <div class="col-md-6 mb-3">
        <label for="last_name_he" class="form-label">שם משפחה (Last Name, Hebrew)</label>
        <input type="text" class="form-control" id="last_name_he" name="last_name_he" dir="rtl" required>
        <div class="invalid-feedback">נא להזין שם משפחה בעברית.</div>
      </div>
    </div>
    <div class="row">
      <div class="col-md-6 mb-3">
        <label for="first_name_en" class="form-label">First Name (English)</label>
        <input type="text" class="form-control" id="first_name_en" name="first_name_en" required>
        <div class="invalid-feedback">Please enter your first name in English.</div>
      </div>
      <div class="col-md-6 mb-3">
        <label for="last_name_en" class="form-label">Last Name (English)</label>
        <input type="text" class="form-control" id="last_name_en" name="last_name_en" required>
        <div class="invalid-feedback">Please enter your last name in English.</div>
      </div>
    </div>
    <div class="mb-3">
      <label for="phone" class="form-label">Phone Number</label>
      <input type="tel" class="form-control" id="phone" name="phone" pattern="[0-9\-+() ]{7,}" required>
      <div class="invalid-feedback">Please enter a valid phone number.</div>
    </div>
    <div class="mb-3">
      <label for="email" class="form-label">Email</label>
      <input type="email" class="form-control" id="email" name="email" required>
      <div class="invalid-feedback">Please enter a valid email address.</div>
    </div>
    <div class="mb-3">
      <label for="agency" class="form-label">Agency</label>
      <input type="text" class="form-control" id="agency" name="agency">
    </div>
    <div class="mb-3">
      <label for="age" class="form-label">Age (optional)</label>
      <input type="number" class="form-control" id="age" name="age" min="1" max="120">
    </div>
    <div class="mb-3">
      <label for="height" class="form-label">Height (cm, optional)</label>
      <input type="number" class="form-control" id="height" name="height" min="50" max="250">
    </div>
    {{#if project}}
    <div class="mb-3">
      <label for="role" class="form-label">Role</label>
      <select class="form-select" id="role" name="role" required>
        <option value="" selected disabled>Select a role</option>
        {{#each project.roles}}
          <option value="{{this.name}}">{{this.name}}</option>
        {{/each}}
      </select>
      <div class="invalid-feedback">Please select a role.</div>
    </div>
    {{else}}
    <div class="mb-3">
      <label for="role" class="form-label">Role (optional)</label>
      <input type="text" class="form-control" id="role" name="role">
    </div>
    {{/if}}
    <div class="mb-3">
      <label for="profile_pictures" class="form-label">Profile Picture(s) <span class="text-muted">(optional)</span></label>
      <input type="file" class="form-control" id="profile_pictures" name="profile_pictures" accept="image/*" multiple>
      <div class="invalid-feedback">If you wish, you may upload a profile picture.</div>
    </div>    {{#if project}}
      {{#if (eq project.uploadMethod "youtube")}}
        <div class="mb-3">
          <label for="video" class="form-label">Self-Tape Video <span class="text-muted">(optional)</span> (YouTube Upload)</label>
          <input type="file" class="form-control" id="video" name="video" accept="video/*">
          <div class="invalid-feedback">If you wish, you may upload a video file.</div>
        </div>
      {{else}}
        <div class="mb-3">
          <label for="video" class="form-label">Self-Tape Video <span class="text-muted">(optional)</span> (Private Upload)</label>
          <input type="file" class="form-control" id="video" name="video" accept="video/*">
          <div class="invalid-feedback">If you wish, you may upload a video file.</div>
        </div>
      {{/if}}    {{else}}
    <div class="mb-3">
      <label for="video" class="form-label">Self-Tape Video <span class="text-muted">(optional)</span></label>
      <input type="file" class="form-control" id="video" name="video" accept="video/*">
      <div class="invalid-feedback">If you wish, you may upload a video file.</div>
    </div>
    {{/if}}
    <div class="mb-3">
      <label for="showreel_url" class="form-label">Showreel Link (optional)</label>
      <input type="url" class="form-control" id="showreel_url" name="showreel_url" placeholder="https://...">
    </div>    <button type="submit" class="btn btn-primary" id="submit-btn">
      <span id="submit-text">Submit Audition</span>
      <span id="submit-spinner" class="d-none">
        <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
        Uploading...
      </span>
    </button>
  </form>
</div>

<!-- Loading Overlay -->
<div id="loading-overlay" class="d-none position-fixed top-0 start-0 w-100 h-100" style="background-color: rgba(0,0,0,0.8); z-index: 9999;">
  <div class="d-flex justify-content-center align-items-center h-100">
    <div class="text-center text-white">
      <div class="spinner-border mb-3" role="status" style="color: var(--primary-red); width: 4rem; height: 4rem; border-width: 0.3em;">
        <span class="visually-hidden">Loading...</span>
      </div>
      <h4 style="color: var(--primary-red);">
        <i class="fas fa-cloud-upload-alt me-2"></i>
        Uploading Your Audition...
      </h4>
      <p class="text-light">Please don't close this page. This may take a few moments.</p>
      <div class="progress mx-auto mt-3" style="width: 300px; height: 8px;">
        <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="background-color: var(--primary-red); width: 100%"></div>
      </div>
    </div>
  </div>
</div>

{{> footer}}
<script>
// Bootstrap validation for client-side feedback
(function () {
  'use strict';
  var forms = document.querySelectorAll('.needs-validation');
  Array.prototype.slice.call(forms).forEach(function (form) {
    form.addEventListener('submit', function (event) {
      if (!form.checkValidity()) {
        event.preventDefault();
        event.stopPropagation();
      } else {
        // Show loading overlay and update button
        document.getElementById('loading-overlay').classList.remove('d-none');
        document.getElementById('submit-text').classList.add('d-none');
        document.getElementById('submit-spinner').classList.remove('d-none');
        document.getElementById('submit-btn').disabled = true;
      }
      form.classList.add('was-validated');
    }, false);
  });
})();
</script>
