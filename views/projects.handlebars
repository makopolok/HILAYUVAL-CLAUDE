{{!-- views/projects.handlebars --}}
{{> header}}
<div class="container mt-5">
  <h1 class="display-4 mb-4">Projects</h1>
  <a href="/projects/create" class="btn btn-outline-success mb-3">Create New Project</a>
  <form class="row g-3 mb-4" method="GET" action="">
    <div class="col-md-4">
      <input type="text" class="form-control" name="name" placeholder="Filter by actor name" value="{{query.name}}">
    </div>
    <div class="col-md-4">
      <input type="text" class="form-control" name="email" placeholder="Filter by email" value="{{query.email}}">
    </div>
    <div class="col-md-4">
      <button type="submit" class="btn btn-outline-danger">Global Search</button>
      <a href="/projects" class="btn btn-outline-secondary ms-2">Clear</a>
    </div>
  </form>
  {{#if searchPerformed}}
  <div class="card mb-4">
    <div class="card-header">Audition Search Results</div>
    <div class="card-body">
      {{#if searchError}}
        <div class="alert alert-danger mb-0">{{searchError}}</div>
      {{else}}
        {{#if searchResults.length}}
          <div class="table-responsive">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>Performer</th>
                  <th>Email</th>
                  <th>Role</th>
                  <th>Project</th>
                  <th>Submitted</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {{#each searchResults}}
                <tr>
                  <td>{{this.display_name}}</td>
                  <td>{{this.email}}</td>
                  <td>{{this.role}}</td>
                  <td>{{this.project_name}}</td>
                  <td>{{this.created_at_formatted}}</td>
                  <td>
                    <a href="/projects/{{this.project_id}}/auditions" class="btn btn-outline-primary btn-sm">View Auditions</a>
                  </td>
                </tr>
                {{/each}}
              </tbody>
            </table>
          </div>
        {{else}}
          <p class="mb-0">No auditions matched your search.</p>
        {{/if}}
      {{/else}}
    </div>
  </div>
  {{/if}}
  {{#if projects.length}}
    <table class="table table-bordered table-hover">
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
          <th>Created</th>
          <th>Audition Form Link</th>
          <th>Audition Playlist</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {{#each projects}}
        <tr>
          <td>{{this.name}}</td>
          <td>{{this.description}}</td>
          <td>{{this.createdAt}}</td>
          <td>
            <a href="/audition/{{this.id}}" target="_blank">/audition/{{this.id}}</a>
          </td>
          <td>
            <a href="/projects/{{this.id}}/auditions" class="btn btn-outline-danger btn-sm">View Auditions</a>
          </td>
          <td>
            <a href="/projects/{{this.id}}/edit" class="btn btn-outline-secondary btn-sm">Edit</a>
          </td>
        </tr>
        {{/each}}
      </tbody>
    </table>
  {{else}}
    <p>No projects found.</p>
  {{/if}}
  
  <hr class="my-4">
  {{! Debug: Show raw deploymentInfo object }}
  {{#if deploymentInfo}}
  <div class="alert alert-warning small mb-2">
    <strong>DEBUG - Raw data:</strong> 
    Commit: {{deploymentInfo.commit}}, Version: {{deploymentInfo.version}}, Branch: {{deploymentInfo.branch}}, Date: {{deploymentInfo.deployDate}}
  </div>
  {{else}}
  <div class="alert alert-danger small mb-2">
    <strong>DEBUG:</strong> deploymentInfo is null/undefined!
  </div>
  {{/if}}
  
  <div class="alert alert-info small mb-3">
    <strong>Version Info:</strong> 
    Commit: {{deploymentInfo.commit}} | 
    Version: {{deploymentInfo.version}} | 
    Branch: {{deploymentInfo.branch}} | 
    Deployed: {{deploymentInfo.deployDate}}
  </div>
</div>
{{> footer}}
